<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visual Music Sequencer Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e1e2e 0%, #2d2d44 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: auto;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #00d4ff, #5b86e5);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .control-group {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
        }

        .control-group h3 {
            margin-bottom: 15px;
            color: #00d4ff;
            font-size: 1.1em;
        }

        .transport-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(45deg, #00d4ff, #5b86e5);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .playing {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 20px rgba(0, 212, 255, 0.3); }
            50% { box-shadow: 0 0 30px rgba(0, 212, 255, 0.6); }
        }

        .slider-container {
            margin: 10px 0;
        }

        .slider-container label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(45deg, #00d4ff, #5b86e5);
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(45deg, #00d4ff, #5b86e5);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .select {
            width: 100%;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 14px;
        }

        .select option {
            background: #2d2d44;
            color: white;
        }

        .sequencer {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .pattern-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .pattern-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .step-indicator {
            display: flex;
            gap: 4px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .step-light {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transition: all 0.2s ease;
        }

        .step-light.active {
            background: #00d4ff;
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.6);
            transform: scale(1.2);
        }

        .grid {
            display: grid;
            gap: 2px;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            overflow-x: auto;
        }

        .grid-16 {
            grid-template-columns: 150px repeat(16, 1fr);
            min-width: 800px;
        }

        .grid-32 {
            grid-template-columns: 150px repeat(32, 1fr);
            min-width: 1200px;
        }

        .track-label {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            padding: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .track-controls {
            display: flex;
            gap: 5px;
        }

        .volume-control {
            width: 40px;
            height: 4px;
        }

        .mute-btn {
            padding: 4px 8px;
            font-size: 10px;
            border-radius: 4px;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
        }

        .mute-btn.muted {
            background: #ff6b6b;
        }

        .step {
            aspect-ratio: 1;
            min-height: 35px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            background: rgba(255, 255, 255, 0.05);
        }

        .step:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: scale(1.05);
        }

        .step.active {
            background: linear-gradient(45deg, #00d4ff, #5b86e5);
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.4);
        }

        .step.playing {
            animation: stepPulse 0.1s ease-out;
        }

        @keyframes stepPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); box-shadow: 0 0 20px rgba(255, 255, 255, 0.6); }
            100% { transform: scale(1); }
        }

        .step.beat-4 {
            border-left: 3px solid #00d4ff;
        }

        .step.beat-8 {
            border-left: 2px solid rgba(0, 212, 255, 0.6);
        }

        .visualizer {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .visualizer h3 {
            text-align: center;
            margin-bottom: 15px;
            color: #00d4ff;
        }

        .waveform {
            height: 100px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }

        .wave-bars {
            display: flex;
            align-items: end;
            height: 100%;
            padding: 10px;
            gap: 2px;
        }

        .wave-bar {
            flex: 1;
            background: linear-gradient(to top, #00d4ff, #5b86e5);
            border-radius: 2px;
            transition: height 0.1s ease;
            min-height: 2px;
        }

        .effects-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .effect-control {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .swing-indicator {
            display: inline-block;
            margin-left: 10px;
            font-size: 0.9em;
            color: #00d4ff;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .controls {
                grid-template-columns: 1fr;
            }
            
            .transport-controls {
                justify-content: center;
            }
            
            .pattern-controls {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎵 Visual Music Sequencer Pro</h1>
            <p>Professional-grade drum machine and beat sequencer</p>
        </div>

        <div class="controls">
            <div class="control-group">
                <h3>🎮 Transport Controls</h3>
                <div class="transport-controls">
                    <button class="btn btn-primary" id="playBtn">▶️ Play</button>
                    <button class="btn btn-secondary" id="pauseBtn">⏸️ Pause</button>
                    <button class="btn btn-danger" id="stopBtn">⏹️ Stop</button>
                    <button class="btn btn-secondary" id="clearBtn">🗑️ Clear</button>
                </div>
            </div>

            <div class="control-group">
                <h3>⚡ Tempo & Timing</h3>
                <div class="slider-container">
                    <label for="tempoSlider">Tempo: <span id="tempoValue">120</span> BPM</label>
                    <input type="range" id="tempoSlider" class="slider" min="60" max="200" value="120">
                </div>
                <div class="slider-container">
                    <label for="swingSlider">Swing: <span id="swingValue">0</span>%<span class="swing-indicator" id="swingIndicator"></span></label>
                    <input type="range" id="swingSlider" class="slider" min="0" max="50" value="0">
                </div>
            </div>

            <div class="control-group">
                <h3>🎛️ Pattern Settings</h3>
                <div class="slider-container">
                    <label for="stepsSlider">Steps: <span id="stepsValue">16</span></label>
                    <input type="range" id="stepsSlider" class="slider" min="8" max="32" value="16" step="8">
                </div>
                <div class="slider-container">
                    <label for="kitSelector">Drum Kit:</label>
                    <select id="kitSelector" class="select">
                        <option value="acoustic">🥁 Acoustic Kit</option>
                        <option value="electronic">🔊 Electronic Kit</option>
                        <option value="trap">🎯 Trap Kit</option>
                        <option value="vintage">📻 Vintage Kit</option>
                    </select>
                </div>
            </div>

            <div class="control-group">
                <h3>🎚️ Master Controls</h3>
                <div class="slider-container">
                    <label for="masterVolume">Master Volume: <span id="masterVolumeValue">70</span>%</label>
                    <input type="range" id="masterVolume" class="slider" min="0" max="100" value="70">
                </div>
                <div class="pattern-controls">
                    <button class="btn btn-secondary" id="randomizeBtn">🎲 Randomize</button>
                    <button class="btn btn-secondary" id="exportBtn">💾 Export</button>
                </div>
            </div>
        </div>

        <div class="visualizer">
            <h3>📊 Audio Waveform</h3>
            <div class="waveform">
                <div class="wave-bars" id="waveBars"></div>
            </div>
        </div>

        <div class="sequencer">
            <div class="pattern-controls">
                <div class="pattern-info">
                    <h3>🎼 Pattern Grid</h3>
                    <span>Click cells to create beats</span>
                </div>
                <button class="btn btn-secondary" id="patternBtn">Pattern A</button>
            </div>
            
            <div class="step-indicator" id="stepIndicator"></div>
            
            <div class="grid grid-16" id="sequencerGrid"></div>
        </div>

        <div class="effects-panel">
            <div class="effect-control">
                <h4>🔊 Reverb</h4>
                <div class="slider-container">
                    <label for="reverbSlider">Amount: <span id="reverbValue">20</span>%</label>
                    <input type="range" id="reverbSlider" class="slider" min="0" max="100" value="20">
                </div>
            </div>
            <div class="effect-control">
                <h4>🎛️ Filter</h4>
                <div class="slider-container">
                    <label for="filterSlider">Cutoff: <span id="filterValue">100</span>%</label>
                    <input type="range" id="filterSlider" class="slider" min="10" max="100" value="100">
                </div>
            </div>
            <div class="effect-control">
                <h4>🔄 Pattern</h4>
                <div class="transport-controls">
                    <button class="btn btn-secondary" id="copyBtn">📋 Copy</button>
                    <button class="btn btn-secondary" id="pasteBtn">📄 Paste</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        class VisualMusicSequencer {
            constructor() {
                this.isPlaying = false;
                this.currentStep = 0;
                this.tempo = 120;
                this.steps = 16;
                this.swing = 0;
                this.pattern = {};
                this.tracks = [
                    { name: 'Kick', frequency: 60, volume: 0.8, muted: false },
                    { name: 'Snare', frequency: 200, volume: 0.7, muted: false },
                    { name: 'Hi-Hat', frequency: 800, volume: 0.6, muted: false },
                    { name: 'Open Hat', frequency: 1200, volume: 0.5, muted: false },
                    { name: 'Crash', frequency: 2000, volume: 0.6, muted: false },
                    { name: 'Ride', frequency: 1500, volume: 0.5, muted: false },
                    { name: 'Clap', frequency: 300, volume: 0.7, muted: false },
                    { name: 'Perc', frequency: 400, volume: 0.6, muted: false }
                ];
                this.audioContext = null;
                this.masterGain = null;
                this.intervalId = null;
                this.copiedPattern = null;
                this.currentKit = 'acoustic';
                
                this.initAudio();
                this.initializePattern();
                this.setupEventListeners();
                this.renderGrid();
                this.renderStepIndicator();
                this.renderWaveform();
            }

            initAudio() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    this.masterGain = this.audioContext.createGain();
                    this.masterGain.connect(this.audioContext.destination);
                    this.masterGain.gain.value = 0.7;
                } catch (error) {
                    console.warn('Audio context not supported');
                }
            }

            initializePattern() {
                this.tracks.forEach((track, trackIndex) => {
                    this.pattern[trackIndex] = new Array(32).fill(false);
                });
                
                // Add some default patterns
                this.pattern[0][0] = true; // Kick on 1
                this.pattern[0][8] = true; // Kick on 9
                this.pattern[1][4] = true; // Snare on 5
                this.pattern[1][12] = true; // Snare on 13
                this.pattern[2][2] = true; // Hi-hat
                this.pattern[2][6] = true;
                this.pattern[2][10] = true;
                this.pattern[2][14] = true;
            }

            setupEventListeners() {
                // Transport controls
                document.getElementById('playBtn').addEventListener('click', () => this.play());
                document.getElementById('pauseBtn').addEventListener('click', () => this.pause());
                document.getElementById('stopBtn').addEventListener('click', () => this.stop());
                document.getElementById('clearBtn').addEventListener('click', () => this.clear());

                // Tempo and swing
                document.getElementById('tempoSlider').addEventListener('input', (e) => {
                    this.tempo = parseInt(e.target.value);
                    document.getElementById('tempoValue').textContent = this.tempo;
                    if (this.isPlaying) {
                        this.stop();
                        this.play();
                    }
                });

                document.getElementById('swingSlider').addEventListener('input', (e) => {
                    this.swing = parseInt(e.target.value);
                    document.getElementById('swingValue').textContent = this.swing;
                    const indicator = document.getElementById('swingIndicator');
                    indicator.textContent = this.swing > 0 ? '♪♫' : '';
                });

                // Steps
                document.getElementById('stepsSlider').addEventListener('input', (e) => {
                    this.steps = parseInt(e.target.value);
                    document.getElementById('stepsValue').textContent = this.steps;
                    this.renderGrid();
                    this.renderStepIndicator();
                });

                // Kit selector
                document.getElementById('kitSelector').addEventListener('change', (e) => {
                    this.currentKit = e.target.value;
                    this.updateKitSounds();
                });

                // Master volume
                document.getElementById('masterVolume').addEventListener('input', (e) => {
                    const volume = parseInt(e.target.value) / 100;
                    document.getElementById('masterVolumeValue').textContent = e.target.value;
                    if (this.masterGain) {
                        this.masterGain.gain.value = volume;
                    }
                });

                // Effects
                document.getElementById('reverbSlider').addEventListener('input', (e) => {
                    document.getElementById('reverbValue').textContent = e.target.value;
                });

                document.getElementById('filterSlider').addEventListener('input', (e) => {
                    document.getElementById('filterValue').textContent = e.target.value;
                });

                // Pattern controls
                document.getElementById('randomizeBtn').addEventListener('click', () => this.randomizePattern());
                document.getElementById('exportBtn').addEventListener('click', () => this.exportPattern());
                document.getElementById('copyBtn').addEventListener('click', () => this.copyPattern());
                document.getElementById('pasteBtn').addEventListener('click', () => this.pastePattern());
            }

            updateKitSounds() {
                const kits = {
                    acoustic: [
                        { name: 'Kick', frequency: 60, volume: 0.8 },
                        { name: 'Snare', frequency: 200, volume: 0.7 },
                        { name: 'Hi-Hat', frequency: 800, volume: 0.6 },
                        { name: 'Open Hat', frequency: 1200, volume: 0.5 },
                        { name: 'Crash', frequency: 2000, volume: 0.6 },
                        { name: 'Ride', frequency: 1500, volume: 0.5 },
                        { name: 'Clap', frequency: 300, volume: 0.7 },
                        { name: 'Perc', frequency: 400, volume: 0.6 }
                    ],
                    electronic: [
                        { name: 'Kick', frequency: 40, volume: 0.9 },
                        { name: 'Snare', frequency: 150, volume: 0.8 },
                        { name: 'Hi-Hat', frequency: 1000, volume: 0.6 },
                        { name: 'Zap', frequency: 2500, volume: 0.5 },
                        { name: 'Bass', frequency: 80, volume: 0.7 },
                        { name: 'Lead', frequency: 600, volume: 0.6 },
                        { name: 'FX', frequency: 1800, volume: 0.5 },
                        { name: 'Noise', frequency: 3000, volume: 0.4 }
                    ],
                    trap: [
                        { name: '808', frequency: 35, volume: 1.0 },
                        { name: 'Snare', frequency: 180, volume: 0.8 },
                        { name: 'Hi-Hat', frequency: 1200, volume: 0.5 },
                        { name: 'Perc', frequency: 500, volume: 0.6 },
                        { name: 'Clap', frequency: 250, volume: 0.7 },
                        { name: 'Rim', frequency: 400, volume: 0.5 },
                        { name: 'Vocal', frequency: 800, volume: 0.6 },
                        { name: 'FX', frequency: 2000, volume: 0.4 }
                    ],
                    vintage: [
                        { name: 'Kick', frequency: 70, volume: 0.8 },
                        { name: 'Snare', frequency: 220, volume: 0.7 },
                        { name: 'Hat', frequency: 600, volume: 0.5 },
                        { name: 'Tom', frequency: 150, volume: 0.6 },
                        { name: 'Cymbal', frequency: 1800, volume: 0.5 },
                        { name: 'Cowbell', frequency: 800, volume: 0.6 },
                        { name: 'Clave', frequency: 1000, volume: 0.5 },
                        { name: 'Shake', frequency: 1500, volume: 0.4 }
                    ]
                };

                this.tracks = kits[this.currentKit].map((track, index) => ({
                    ...track,
                    muted: this.tracks[index]?.muted || false
                }));

                this.renderGrid();
            }

            renderGrid() {
                const grid = document.getElementById('sequencerGrid');
                grid.innerHTML = '';
                grid.className = `grid grid-${this.steps}`;

                // Render track labels
                this.tracks.forEach((track, trackIndex) => {
                    const label = document.createElement('div');
                    label.className = 'track-label';
                    label.innerHTML = `
                        <span>${track.name}</span>
                        <div class="track-controls">
                            <input type="range" class="volume-control" min="0" max="100" value="${track.volume * 100}" 
                                   onchange="sequencer.updateTrackVolume(${trackIndex}, this.value)">
                            <button class="mute-btn ${track.muted ? 'muted' : ''}" 
                                    onclick="sequencer.toggleMute(${trackIndex})">M</button>
                        </div>
                    `;
                    grid.appendChild(label);

                    // Render steps for this track
                    for (let step = 0; step < this.steps; step++) {
                        const stepEl = document.createElement('div');
                        stepEl.className = `step ${this.pattern[trackIndex][step] ? 'active' : ''}`;
                        
                        // Add beat indicators
                        if (step % 4 === 0) {
                            stepEl.classList.add('beat-4');
                        } else if (step % 2 === 0) {
                            stepEl.classList.add('beat-8');
                        }

                        stepEl.addEventListener('click', () => {
                            this.toggleStep(trackIndex, step);
                        });

                        grid.appendChild(stepEl);
                    }
                });
            }

            renderStepIndicator() {
                const indicator = document.getElementById('stepIndicator');
                indicator.innerHTML = '';
                
                for (let i = 0; i < this.steps; i++) {
                    const light = document.createElement('div');
                    light.className = 'step-light';
                    indicator.appendChild(light);
                }
            }

            renderWaveform() {
                const waveBars = document.getElementById('waveBars');
                waveBars.innerHTML = '';
                
                for (let i = 0; i < 32; i++) {
                    const bar = document.createElement('div');
                    bar.className = 'wave-bar';
                    bar.style.height = '10%';
                    waveBars.appendChild(bar);
                }
            }

            updateWaveform() {
                const bars = document.querySelectorAll('.wave-bar');
                bars.forEach((bar, index) => {
                    const height = Math.random() * 80 + 10;
                    bar.style.height = `${height}%`;
                });
            }

            toggleStep(trackIndex, step) {
                this.pattern[trackIndex][step] = !this.pattern[trackIndex][step];
                this.renderGrid();
            }

            updateTrackVolume(trackIndex, value) {
                this.tracks[trackIndex].volume = value / 100;
            }

            toggleMute(trackIndex) {
                this.tracks[trackIndex].muted = !this.tracks[trackIndex].muted;
                this.renderGrid();
            }

            play() {
                if (!this.audioContext) {
                    this.initAudio();
                }
                
                if (this.audioContext.state === 'suspended') {
                    this.audioContext.resume();
                }

                this.isPlaying = true;
                document.getElementById('playBtn').classList.add('playing');
                
                const stepTime = (60 / this.tempo / 4) * 1000; // 16th note in milliseconds
                
                this.intervalId = setInterval(() => {
                    this.playStep();
                    this.currentStep = (this.currentStep + 1) % this.steps;
                }, stepTime);
            }

            pause() {
                this.isPlaying = false;
                document.getElementById('playBtn').classList.remove('playing');
                if (this.intervalId) {
                    clearInterval(this.intervalId);
                    this.intervalId = null;
                }
            }

            stop() {
                this.pause();
                this.currentStep = 0;
                this.updateStepIndicator();
            }

            clear() {
                this.stop();
                this.tracks.forEach((track, trackIndex) => {
                    this.pattern[trackIndex] = new Array(32).fill(false);
                });
                this.renderGrid();
            }

            playStep() {
                // Update step indicator
                this.updateStepIndicator();
                
                // Play sounds for active steps
                this.tracks.forEach((track, trackIndex) => {
                    if (this.pattern[trackIndex][this.currentStep] && !track.muted) {
                        this.playSound(track);
                        this.animateStep(trackIndex, this.currentStep);
                    }
                });

                // Update waveform
                this.updateWaveform();
            }

            updateStepIndicator() {
                const lights = document.querySelectorAll('.step-light');
                lights.forEach((light, index) => {
                    light.classList.toggle('active', index === this.currentStep);
                });
            }

            animateStep(trackIndex, step) {
                const grid = document.getElementById('sequencerGrid');
                const stepElements = grid.children;
                const stepIndex = trackIndex * (this.steps + 1) + step + 1;
                const stepEl = stepElements[stepIndex];
                
                if (stepEl) {
                    stepEl.classList.add('playing');
                    setTimeout(() => {
                        stepEl.classList.remove('playing');
                    }, 100);
                }
            }

            playSound(track) {
                if (!this.audioContext) return;

                try {
                    const oscillator = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();
                    const filter = this.audioContext.createBiquadFilter();

                    // Configure based on track type and current kit
                    this.configureSound(oscillator, gainNode, filter, track);

                    // Connect audio graph
                    oscillator.connect(filter);
                    filter.connect(gainNode);
                    gainNode.connect(this.masterGain);

                    // Start and stop
                    const now = this.audioContext.currentTime;
                    oscillator.start(now);
                    oscillator.stop(now + 0.2);

                } catch (error) {
                    console.warn('Audio playback error:', error);
                }
            }

            configureSound(oscillator, gainNode, filter, track) {
                const now = this.audioContext.currentTime;
                const reverbAmount = document.getElementById('reverbSlider').value / 100;
                const filterCutoff = document.getElementById('filterSlider').value / 100;

                // Set oscillator type based on track
                if (track.name.includes('Kick') || track.name.includes('808')) {
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(track.frequency, now);
                    oscillator.frequency.exponentialRampToValueAtTime(track.frequency * 0.3, now + 0.1);
                    gainNode.gain.setValueAtTime(track.volume, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.3);
                } else if (track.name.includes('Snare') || track.name.includes('Clap')) {
                    oscillator.type = 'square';
                    oscillator.frequency.setValueAtTime(track.frequency, now);
                    gainNode.gain.setValueAtTime(track.volume * 0.3, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.15);
                } else if (track.name.includes('Hat') || track.name.includes('Hi-Hat')) {
                    oscillator.type = 'sawtooth';
                    oscillator.frequency.setValueAtTime(track.frequency, now);
                    gainNode.gain.setValueAtTime(track.volume * 0.2, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.08);
                } else {
                    oscillator.type = 'triangle';
                    oscillator.frequency.setValueAtTime(track.frequency, now);
                    gainNode.gain.setValueAtTime(track.volume * 0.4, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.2);
                }

                // Apply filter
                filter.type = 'lowpass';
                filter.frequency.setValueAtTime(track.frequency * 5 * filterCutoff, now);
                filter.Q.value = 1;

                // Apply swing timing
                if (this.swing > 0 && this.currentStep % 2 === 1) {
                    const swingDelay = (this.swing / 100) * 0.1;
                    oscillator.start(now + swingDelay);
                }
            }

            randomizePattern() {
                this.tracks.forEach((track, trackIndex) => {
                    for (let step = 0; step < this.steps; step++) {
                        // Higher probability for kick and snare on strong beats
                        let probability = 0.15;
                        if ((trackIndex === 0 && step % 4 === 0) || (trackIndex === 1 && step % 8 === 4)) {
                            probability = 0.7;
                        } else if (trackIndex === 2) { // Hi-hat
                            probability = 0.4;
                        }
                        
                        this.pattern[trackIndex][step] = Math.random() < probability;
                    }
                });
                this.renderGrid();
            }

            exportPattern() {
                const patternData = {
                    tempo: this.tempo,
                    steps: this.steps,
                    swing: this.swing,
                    kit: this.currentKit,
                    pattern: this.pattern,
                    tracks: this.tracks.map(track => ({
                        name: track.name,
                        volume: track.volume,
                        muted: track.muted
                    }))
                };

                const dataStr = JSON.stringify(patternData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `pattern_${Date.now()}.json`;
                link.click();
                
                URL.revokeObjectURL(url);
                
                // Show success message
                this.showNotification('Pattern exported successfully!', 'success');
            }

            copyPattern() {
                this.copiedPattern = JSON.parse(JSON.stringify(this.pattern));
                this.showNotification('Pattern copied to clipboard!', 'info');
            }

            pastePattern() {
                if (this.copiedPattern) {
                    this.pattern = JSON.parse(JSON.stringify(this.copiedPattern));
                    this.renderGrid();
                    this.showNotification('Pattern pasted!', 'info');
                } else {
                    this.showNotification('No pattern in clipboard!', 'warning');
                }
            }

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 15px 20px;
                    border-radius: 8px;
                    color: white;
                    font-weight: 600;
                    z-index: 1000;
                    animation: slideIn 0.3s ease-out;
                    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
                `;

                const colors = {
                    success: 'linear-gradient(45deg, #00d4ff, #5b86e5)',
                    info: 'linear-gradient(45deg, #667eea, #764ba2)',
                    warning: 'linear-gradient(45deg, #ff9a56, #ff6b6b)'
                };

                notification.style.background = colors[type] || colors.info;
                notification.textContent = message;

                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease-in forwards';
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 300);
                }, 3000);
            }
        }

        // Initialize the sequencer
        const sequencer = new VisualMusicSequencer();

        // Add some CSS animations for notifications
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }

            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }

            .notification-enter {
                animation: slideIn 0.3s ease-out;
            }

            .notification-exit {
                animation: slideOut 0.3s ease-in;
            }
        `;
        document.head.appendChild(style);

        // Add keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                if (sequencer.isPlaying) {
                    sequencer.pause();
                } else {
                    sequencer.play();
                }
            } else if (e.code === 'Escape') {
                sequencer.stop();
            } else if (e.ctrlKey || e.metaKey) {
                switch (e.code) {
                    case 'KeyC':
                        e.preventDefault();
                        sequencer.copyPattern();
                        break;
                    case 'KeyV':
                        e.preventDefault();
                        sequencer.pastePattern();
                        break;
                    case 'KeyS':
                        e.preventDefault();
                        sequencer.exportPattern();
                        break;
                    case 'KeyR':
                        e.preventDefault();
                        sequencer.randomizePattern();
                        break;
                }
            }
        });

        // Auto-save functionality
        setInterval(() => {
            const patternData = {
                tempo: sequencer.tempo,
                steps: sequencer.steps,
                swing: sequencer.swing,
                kit: sequencer.currentKit,
                pattern: sequencer.pattern
            };
            // In a real application, this would save to a database
            console.log('Auto-saved pattern:', patternData);
        }, 30000); // Auto-save every 30 seconds

    </script>
</body>
</html>